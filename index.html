<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Conversor CSV ‚Üí JSON</title>
</head>
<body>
  <h4>Escuchando datos desde App Inventor...</h4>
  <script>
    window.addEventListener("message", function(event) {
      const textoPlano = event.data;

      // Convertir texto plano a JSON
      const pares = textoPlano.split(";").map(par => par.split("="));
      const datos = Object.fromEntries(pares);

      console.log("üì¶ JSON convertido:", datos);

      // Enviar a servidor
      fetch("https://octasf-hcip.hf.space/guardar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(datos)
      })
      .then(res => res.json()) // üëà Cambiado a JSON
      .then(respuesta => {
        console.log("‚úÖ Enviado a servidor:", respuesta);
        // Enviar pantalla a App Inventor
        window.AppInventor.setWebViewString(respuesta.pantalla);

        // Guardar resultado tambi√©n si lo necesitas despu√©s
        window.resultadoJuego = respuesta.resultado;
      })
      .catch(err => console.error("‚ùå Error:", err));
    });
  </script>
</body>
</html>
