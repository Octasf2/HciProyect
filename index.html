<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Conversor CSV ‚Üí JSON</title>
</head>
<body>
  <h4>Escuchando datos desde App Inventor...</h4>
  <script>
    window.addEventListener("message", function(event) {
      const textoPlano = event.data;

      // Paso 1: Convertir texto plano a JSON
      // Ej: "vidas=3;puntaje=1500;tiempo=45;nivel=2;resultado=gan√≥"
      const pares = textoPlano.split(";").map(par => par.split("="));
      const datos = Object.fromEntries(pares);

      console.log("üì¶ JSON convertido:", datos);

      // Paso 2: Enviar a Heroku
      fetch("https://dry-springs-20735-bb95a27d9e9e.herokuapp.com/guardar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(datos)
      })
      .then(res => res.text())
      .then(msg => {
        console.log("‚úÖ Enviado a servidor:", msg);
        window.parent.postMessage(msg, "*");  // üëà ESTA L√çNEA ENV√çA LA RESPUESTA A MIT
      })
      .catch(err => console.error("‚ùå Error:", err));
    });
  </script>
</body>
</html>
